<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.crusoe.relaxedintegration.data.user.mapper.UserMapper">  
    <resultMap id="rUser" type="com.crusoe.relaxedintegration.data.user.bean.RUser">  
        <result column="rUserId" property="rUserId" javaType="Integer" jdbcType="INTEGER"/>
        <result column="s1UserId" property="s1UserId" javaType="String" jdbcType="VARCHAR"/>
        <result column="s2UserId" property="s2UserId" javaType="String" jdbcType="VARCHAR"/>
        <result column="s3UserId" property="s3UserId" javaType="String" jdbcType="VARCHAR"/>
        <result column="feature1" property="feature1" javaType="String" jdbcType="VARCHAR"/>
        <result column="feature2" property="feature2" javaType="String" jdbcType="VARCHAR"/>
        <result column="feature3" property="feature3" javaType="String" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List" >
	   neuUser.neuUserId,gUserId,wUserId,gtUserId,role
	</sql> 
	
	<select id="getRUser" resultMap="rUser" statementType="STATEMENT">  
		set @sUserId='${userId}';
		set @feature1=${feature1};
		set @feature2=${feature2};
		set @feature3=${feature3};
		set @rUserId:=ifnull((select rUserId from ruser where ${source}UserId=@sUserId), -- 主键
			ifnull((select rUserId from ruser where feature1=@feature1), 
				ifnull((select rUserId from ruser where feature2=@feature2),
					(select rUserId from ruser where feature3=@feature3))));
					
		insert into ruser(rUserId, ${source}UserId, feature1, feature2, feature3)
		select @rUserId, @sUserId, @feature1, @feature2, @feature3
		ON DUPLICATE KEY UPDATE 
			${source}UserId=ifnull(values(${source}UserId), ${source}UserId),
			feature1=ifnull(values(feature1), feature1),
			feature2=ifnull(values(feature2), feature2),
			feature3=ifnull(values(feature3), feature3);
		
		select * from ruser where rUserId=ifnull(@rUserId, LAST_INSERT_ID());
  		
	</select>    
	
	
</mapper>













